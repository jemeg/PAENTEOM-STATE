<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <script>
  document.addEventListener('DOMContentLoaded', () => {
    const medic = localStorage.getItem('activeMedic');
    const activeCode = localStorage.getItem('activeCode');
    const discordId = localStorage.getItem('discordId');

    // ğŸš« Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø£ÙŠ Ù†Ø¸Ø§Ù… â†’ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ login.html
    if (!medic && (!activeCode || !discordId)) {
      window.location.href = "login.html";
    }
  });
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù - ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="header-section">
            <div class="logo-container">
                <div class="logo-shine"></div>
                <img src="logo.png" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©" class="ministry-logo">
            </div>
            <div class="title-container">
                <h1>
                    <span class="title-highlight">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù</span>
                    <br>
                    <span class="ministry-name">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©</span>
                </h1>
                <div class="employee-info mt-2">
                    <span id="employeeName" class="fw-bold"></span>
                    <span class="mx-2">|</span>
                    <span id="employeeId"></span>
                </div>
            </div>
            <div class="admin-controls">
                <div class="ms-auto">
                    <a href="login.html" class="btn btn-outline-danger" onclick="sessionStorage.removeItem('employeeData')">
                        <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </a>
                    <a href="protocols.html" class="btn btn-info-1">
                        <i class="fas fa-book"></i> Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø¥Ø³Ø¹Ø§Ù
                    </a>
                    <a href="localStorage.html" class="btn btn-info-2">
                        <i class="fas fa-clock"></i> Ø³Ø¬Ù„ ØªÙˆØ§Ø¬Ø¯ Ø§Ù„Ù…Ø³Ø¹ÙÙŠÙ†
                    </a>
                    <a href="medics-admin.html" class="btn btn-outline-primary me-2 d-none" id="adminBtn" style="color: #6200ff; border-color: #b890f8;">
                        <i class="fas fa-cog me-1"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </a>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± -->
        <div class="image-gallery">
            <div class="gallery-header">
                <h3>ØµÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚</h3>
            </div>
            <div class="image-grid">
                <div class="image-card">
                    <img src="teem.png" alt="ÙØ±ÙŠÙ‚ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù">
                    <div class="image-overlay">
                        <span class="image-title">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù</span>
                    </div>
                </div>
                <div class="image-card">
                    <img src="teem2.png" alt="Ø¥Ø¯Ø§Ø±Ø© Ø®Ø¯Ù…Ø§Ø© Ø§Ù„Ø¥Ø³Ø¹Ø§Ù">
                    <div class="image-overlay">
                        <span class="image-title">Ø¥Ø¯Ø§Ø±Ø© Ø®Ø¯Ù…Ø§Ø© Ø§Ù„Ø¥Ø³Ø¹Ø§Ù</span>
                    </div>
                </div>
            </div>
            <div class="gallery-navigation"></div>
        </div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
<div class="row mb-3">
  <div class="col">
    <button class="btn btn-success" onclick="exportToImage()">
      <i class="fas fa-file-image"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ ØµÙˆØ±Ø© (PNG)
    </button>
    <button class="btn btn-danger" onclick="exportToPDF()">
      <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF
    </button>
  </div>
</div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª -->
        <div class="title-container">
            <h1><span class="ministry-name">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</span></h1>
        </div>
        <div class="table-responsive mb-5">
            <table class="table table-bordered table-hover" id="scheduleTable">
                <thead class="table-dark">
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„ÙŠÙˆÙ…</th>
                        <th>Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ØªÙØ¹ÙŠÙ„</th>
                    </tr>
                </thead>
                <tbody id="scheduleTableBody"></tbody>
                <tr>
                    <td><i class="fas fa-check-circle text-center"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„</td>
                    <td><i class="fas fa-check-circle text-center"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„</td>
                    <td><i class="fas fa-check-circle text-center"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„</td>
                    <td><i class="fas fa-check-circle text-danger"></i> Ù‚Ø±ÙŠØ¨Ø§</td>
                    <td><i class="fas fa-check-circle text-success"></i> ØºÙŠØ± Ù…ÙØ¹Ù„</td>
                </tr>
            </table>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¹ÙÙŠÙ† -->
        <div class="title-container">
            <h1><span class="ministry-name">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¹ÙÙŠÙ†</span></h1>
        </div>

        <div class="table-responsive mb-5">
            <table class="table table-striped table-hover align-middle" id="paramedicTable">
                <thead class="table-dark">
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¹Ù</th>
                        <th>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³Ø¹Ù</th>
                        <th>Ø§Ù„Ø¹Ù…Ø±</th>
                        <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                        <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                        <th>Ø£Ø®Ø± ØªÙˆØ§Ø¬Ø¯ Ù„Ùƒ</th>
                        <th>ØªØ­Ø°ÙŠØ±</th>
                    </tr>
                </thead>
                <tbody id="paramedicTableBody">
                    <tr>
                        <td>Ù…Ø­Ù…Ø¯</td>
                        <td>H-60</td>
                        <td>+18</td>
                        <td id="in-H-60"><button class="btn btn-success btn-sm" onclick="recordCheckIn('H-60')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></td>
                        <td id="out-H-60"><button class="btn btn-danger btn-sm" onclick="recordCheckOut('H-60')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></td>
                        <td id="hours-H-60">-</td>
                        <td><i class="fas fa-check-circle text-success"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯</td>
                    </tr>
                    <tr>
                        <td>Ø§Ø­Ù…Ø¯</td>
                        <td>H-8</td>
                        <td>+18</td>
                        <td id="in-H-8"><button class="btn btn-success btn-sm" onclick="recordCheckIn('H-8')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></td>
                        <td id="out-H-8"><button class="btn btn-danger btn-sm" onclick="recordCheckOut('H-8')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></td>
                        <td id="hours-H-8">-</td>
                        <td><i class="fas fa-exclamation-triangle text-danger"></i>Ù„Ù… Ø³ØªØ¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù…Ù†Ø° 3 ÙŠÙˆÙ…</td>
                    </tr>
                    <tr>
                        <td>Ø§ÙŠÙ‡</td>
                        <td>H-23</td>
                        <td>+18</td>
                        <td id="in-H-23"><button class="btn btn-success btn-sm" onclick="recordCheckIn('H-23')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></td>
                        <td id="out-H-23"><button class="btn btn-danger btn-sm" onclick="recordCheckOut('H-23')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></td>
                        <td id="hours-H-23">-</td>
                        <td><i class="fas fa-check-circle text-success"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
        <div class="title-container">
            <h1><span class="ministry-name"> ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ù…Ø³Ø¹ÙÙŠÙ† Ù‚Ø±ÙŠØ¨Ø§ğŸ”¥</span></h1>
        </div>
        <div class="rating-section mb-5">
            <div id="paramedicRatings" class="row gy-3"></div>
        </div>
        
    </div>

    <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
    <nav class="mt-3">
        <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>

    <!-- Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="database.js" type="module"></script>
    <script src="employee-schedule.js"></script>

    
    <!-- ÙƒÙˆØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ­ÙØ¸ Ø§Ù„ÙˆÙ‚Øª -->
    <script>
    // Check if medic is already in the check-in/out table
    function isMedicInTable(medicId) {
        const table = document.getElementById('paramedicTableBody');
        const rows = table.getElementsByTagName('tr');
        for (let row of rows) {
            const idCell = row.cells[1]; // ID is in the second cell
            if (idCell && idCell.textContent.trim() === medicId) {
                return true;
            }
        }
        return false;
    }

    // Add a new medic to the check-in/out table
    function addMedicToTable(medic) {
        const tableBody = document.getElementById('paramedicTableBody');
        const newRow = document.createElement('tr');
        
        // Create table cells
        const nameCell = document.createElement('td');
        nameCell.textContent = medic.name || 'Ù…Ø³Ø¹Ù';
        
        const idCell = document.createElement('td');
        idCell.textContent = medic.id || '';
        
        const ageCell = document.createElement('td');
        ageCell.textContent = '+18';
        
        const inCell = document.createElement('td');
        inCell.id = `in-${medic.id}`;
        inCell.innerHTML = `<button class="btn btn-success btn-sm" onclick="recordCheckIn('${medic.id}')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>`;
        
        const outCell = document.createElement('td');
        outCell.id = `out-${medic.id}`;
        outCell.innerHTML = `<button class="btn btn-danger btn-sm" onclick="recordCheckOut('${medic.id}')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>`;
        
        const hoursCell = document.createElement('td');
        hoursCell.id = `hours-${medic.id}`;
        hoursCell.textContent = '-';
        
        const warningCell = document.createElement('td');
        warningCell.innerHTML = '<i class="fas fa-check-circle text-success"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯';
        
        // Append cells to row
        newRow.appendChild(nameCell);
        newRow.appendChild(idCell);
        newRow.appendChild(ageCell);
        newRow.appendChild(inCell);
        newRow.appendChild(outCell);
        newRow.appendChild(hoursCell);
        newRow.appendChild(warningCell);
        
        // Add row to table
        tableBody.appendChild(newRow);
    }

    // Display employee information and check admin permissions
    document.addEventListener('DOMContentLoaded', function() {
        // Check if it's a medic login
        const medic = JSON.parse(localStorage.getItem('activeMedic') || 'null');
        const activeCode = localStorage.getItem('activeCode');
        
        // Check if it's an employee login
        const employeeData = sessionStorage.getItem('employeeData') || localStorage.getItem('employeeData');
        let employee = null;
        
        if (medic || activeCode) {
            // Medic login
            const nameElement = document.getElementById('employeeName');
            const idElement = document.getElementById('employeeId');
            
            if (medic) {
                nameElement.textContent = medic.name || 'Ù…Ø³Ø¹Ù';
                idElement.textContent = `ÙƒÙˆØ¯: ${medic.id || activeCode || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
                employee = medic; // Set employee object for permission check
                
                // Add medic to check-in/out table if not an admin
                if (!checkAdminPermissions() && !isMedicInTable(medic.id || activeCode)) {
                    addMedicToTable(medic);
                }
            } else {
                nameElement.textContent = 'Ù…Ø³Ø¹Ù';
                idElement.textContent = `ÙƒÙˆØ¯: ${activeCode || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
            }
        } else if (employeeData) {
            // Employee login
            employee = JSON.parse(employeeData);
            document.getElementById('employeeName').textContent = employee.name || 'Ù…ÙˆØ¸Ù';
            document.getElementById('employeeId').textContent = `ÙƒÙˆØ¯: ${employee.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
        }
        
        // Check and set admin permissions
        if (checkAdminPermissions()) {
            document.getElementById('adminBtn').classList.remove('d-none');
        }
    });

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ÙÙ‚Ø· Ù„Ù„Ø±ØªØ¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©
    function checkAdminPermissions() {
        // Check medic login first
        const medic = JSON.parse(localStorage.getItem('activeMedic') || 'null');
        if (medic) {
            // ÙÙ‚Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø±Ø¤ÙŠØ© Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            const adminRoles = ['ÙˆØ²ÙŠØ±', 'Ù†Ø§Ø¦Ø¨ ÙˆØ²ÙŠØ±', 'Ù…Ø¯ÙŠØ± Ù…Ø³ØªØ´ÙÙ‰'];
            return adminRoles.includes(medic.role) || adminRoles.includes(medic.rank);
        }
        
        // Check employee login
        const employeeData = sessionStorage.getItem('employeeData') || localStorage.getItem('employeeData');
        if (!employeeData) return false;
        
        const employee = JSON.parse(employeeData);
        // Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const adminRanks = ['Ù…Ø¯ÙŠØ± Ù…Ø³ØªØ´ÙÙ‰', 'Ù†Ø§Ø¦Ø¨ ÙˆØ²ÙŠØ±', 'ÙˆØ²ÙŠØ±'];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØªØ¨Ø© Ø£Ùˆ Ø§Ù„Ø¯ÙˆØ±
        const hasAdminRank = employee.rank && adminRanks.includes(employee.rank);
        const hasAdminRole = employee.role && adminRanks.includes(employee.role);
        
        return hasAdminRank || hasAdminRole;
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø°ÙˆÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    document.addEventListener('DOMContentLoaded', () => {
        if (checkAdminPermissions()) {
            const adminBtn = document.getElementById('adminBtn');
            if (adminBtn) {
                adminBtn.style.display = 'inline-block';
            }
        }
    });

    function formatTime(date) {
        return date.toLocaleTimeString();
    }

    function calculateDuration(start, end) {
        const diffMs = end - start;
        const diffHrs = diffMs / (1000 * 60 * 60);
        return diffHrs.toFixed(2);
    }

function recordCheckIn(paramedicId) {
  const activeCode = localStorage.getItem("activeCode");
  if (paramedicId !== activeCode) {
    alert("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ ÙƒÙˆØ¯ Ù…Ø³Ø¹Ù Ø¢Ø®Ø±.");
    return;
  }

  const now = new Date();
  const formatted = formatTime(now);
  const inCell = document.getElementById("in-" + paramedicId);
  inCell.textContent = formatted;
  localStorage.setItem(paramedicId + "_login", now.toISOString());

  const outCell = document.getElementById("out-" + paramedicId);
  outCell.innerHTML =
    '<button class="btn btn-danger btn-sm" onclick="recordCheckOut(\'' +
    paramedicId +
    "')\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>";
}

function recordCheckOut(paramedicId) {
  const activeCode = localStorage.getItem("activeCode");
  if (paramedicId !== activeCode) {
    alert("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ ÙƒÙˆØ¯ Ù…Ø³Ø¹Ù Ø¢Ø®Ø±.");
    return;
  }

  const now = new Date();
  const formatted = formatTime(now);
  const outCell = document.getElementById("out-" + paramedicId);
  outCell.textContent = formatted;
  localStorage.setItem(paramedicId + "_logout", now.toISOString());

  const loginTimeISO = localStorage.getItem(paramedicId + "_login");
  if (loginTimeISO) {
    const loginDate = new Date(loginTimeISO);
    const duration = calculateDuration(loginDate, now);
    const hoursCell = document.getElementById("hours-" + paramedicId);
    hoursCell.textContent = duration;
    localStorage.setItem(paramedicId + "_hours", duration);
  }

  const inCell = document.getElementById("in-" + paramedicId);
  inCell.innerHTML =
    '<button class="btn btn-success btn-sm" onclick="recordCheckIn(\'' +
    paramedicId +
    "')\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>";
}

window.addEventListener("DOMContentLoaded", () => {
  const paramedics = ["H-60", "H-8", "H-23"];
  const activeCode = localStorage.getItem("activeCode");

  paramedics.forEach((id) => {
    const loginISO = localStorage.getItem(id + "_login");
    const logoutISO = localStorage.getItem(id + "_logout");
    const hours = localStorage.getItem(id + "_hours");

    const inCell = document.getElementById("in-" + id);
    const outCell = document.getElementById("out-" + id);
    const hoursCell = document.getElementById("hours-" + id);

    // ğŸ”’ ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø¹ÙÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
    if (id !== activeCode) {
      if (inCell.querySelector("button"))
        inCell.querySelector("button").disabled = true;
      if (outCell.querySelector("button"))
        outCell.querySelector("button").disabled = true;
    }

    if (loginISO && (!logoutISO || new Date(loginISO) > new Date(logoutISO))) {
      inCell.textContent = formatTime(new Date(loginISO));
      outCell.innerHTML =
        '<button class="btn btn-danger btn-sm" onclick="recordCheckOut(\'' +
        id +
        "')\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>";
    } else {
      inCell.innerHTML =
        '<button class="btn btn-success btn-sm" onclick="recordCheckIn(\'' +
        id +
        "')\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>";
      if (logoutISO) {
        outCell.textContent = formatTime(new Date(logoutISO));
      }
    }

    if (hours) {
      hoursCell.textContent = hours;
    }
  });
});



        // Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const inCell = document.getElementById("in-" + paramedicId);
        inCell.textContent = formatted;

        // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.setItem(paramedicId + "_login", now.toISOString());

        // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
        const outCell = document.getElementById("out-" + paramedicId);
        outCell.innerHTML = '<button class="btn btn-danger btn-sm" onclick="recordCheckOut(\'' + paramedicId + '\')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>';
    

    function recordCheckOut(paramedicId) {
        const now = new Date();
        const formatted = formatTime(now);

        const outCell = document.getElementById("out-" + paramedicId);
        outCell.textContent = formatted;

        localStorage.setItem(paramedicId + "_logout", now.toISOString());

// Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
const loginTimeISO = localStorage.getItem(paramedicId + "_login");
if (loginTimeISO) {
    const loginDate = new Date(loginTimeISO);
    const now = new Date();

    // Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø¢Ø®Ø± Ø¬Ù„Ø³Ø©
    const newDuration = calculateDuration(loginDate, now);

    // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    let previousTotal = parseFloat(localStorage.getItem(paramedicId + "_hours")) || 0;

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚
    const totalHours = previousTotal + parseFloat(newDuration);

    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    localStorage.setItem(paramedicId + "_hours", totalHours.toFixed(2));

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const hoursCell = document.getElementById("hours-" + paramedicId);
    hoursCell.textContent = totalHours.toFixed(2) + " Ø³Ø§Ø¹Ø©";

    // Ø­Ø°Ù ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø§Ø¯Ù…)
    localStorage.removeItem(paramedicId + "_login");
}


        // Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŒ Ø¹Ø±Ø¶ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
        const inCell = document.getElementById("in-" + paramedicId);
        inCell.innerHTML = '<button class="btn btn-success btn-sm" onclick="recordCheckIn(\'' + paramedicId + '\')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>';
    }

    window.addEventListener("DOMContentLoaded", () => {
        const paramedics = ["H-60", "H-8", "H-23"];
        paramedics.forEach(id => {
            const loginISO = localStorage.getItem(id + "_login");
            const logoutISO = localStorage.getItem(id + "_logout");
            const hours = localStorage.getItem(id + "_hours");

            const inCell = document.getElementById("in-" + id);
            const outCell = document.getElementById("out-" + id);
            const hoursCell = document.getElementById("hours-" + id);

            if (loginISO && (!logoutISO || new Date(loginISO) > new Date(logoutISO))) {
                // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø´Ø·
                inCell.textContent = formatTime(new Date(loginISO));
                outCell.innerHTML = '<button class="btn btn-danger btn-sm" onclick="recordCheckOut(\'' + id + '\')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>';
            } else {
                // Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ Ø¹Ø±Ø¶ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                inCell.innerHTML = '<button class="btn btn-success btn-sm" onclick="recordCheckIn(\'' + id + '\')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>';
                if (logoutISO) {
                    outCell.textContent = formatTime(new Date(logoutISO));
                }
            }

            if (hours) {
                hoursCell.textContent = hours;
            }
        });
    });
    </script>

<script>
async function exportToImage() {
  const body = document.body;

  // Ù†Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„ØµÙØ­Ø©
  const canvas = await html2canvas(body, {
    scale: 2,
    useCORS: true,
    scrollY: -window.scrollY
  });

  const link = document.createElement("a");
  link.download = "Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø§Ø³Ø¹Ø§Ù.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}

async function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const body = document.body;

  // Ù†Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„ØµÙØ­Ø©
  const canvas = await html2canvas(body, {
    scale: 2,
    useCORS: true,
    scrollY: -window.scrollY
  });

  const imgData = canvas.toDataURL("image/png");
  const pdf = new jsPDF("p", "mm", "a4");

  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const imgWidth = pageWidth;
  const imgHeight = (canvas.height * pageWidth) / canvas.width;

  let heightLeft = imgHeight;
  let position = 0;

  pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
  heightLeft -= pageHeight;

  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ø£Ø·ÙˆÙ„ Ù…Ù† ØµÙØ­Ø© A4ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªÙ‚Ø³ÙŠÙ…Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  while (heightLeft > 0) {
    position = heightLeft - imgHeight;
    pdf.addPage();
    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;
  }

  pdf.save("Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø§Ø³Ø¹Ø§Ù.pdf");
}
</script>


</body>
        <footer>
            &copy;  2026 ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© ğŸ‘©â€âš•ï¸ğ“–ğ“±ğ“ªğ”ƒğ”€ğ“ªğ“·ğŸš‘
        </footer>
    </div>
</html>
